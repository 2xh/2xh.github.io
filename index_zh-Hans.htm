<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="color-scheme" content="light dark" />
<title>你好，网站！</title>
<link rel="icon" type="image/gif" href="data:image/gif;base64,R0lGODlhEAAQAPD/AICAgAAAACH5BAUAAAIALAAAAAAQABAAAAImlI+py+0NFIgpUkOvuBl1FATTCIRKSE6mh7HboX2thtHvg+d6XgAAOw==" />
<style type="text/css">body,table{text-align:center}p{color:dimgray}a:hover{color:black}a:active,input[type="reset"]:enabled{color:red}input[type="submit"],[type="reset"]{font-weight:bold}ol,ul{padding-left:1em}textarea{width:100%;height:15em}@media(prefers-color-scheme:dark){p{color:lightgray}a:hover{color:white}a:active{color:lime}}</style>
</head>
<body style="margin-bottom:3em" onbeforeunload="return output.children.length-output.getElementsByTagName('br').length?'':undefined" onunload="func.reset()">
<h1>网站演示</h1><p>一些HTML5中有点用的API的简单测试</p><p>注：脚本已缓存，可脱机运行。<br>为减少流量消耗，可<a href="#" style="font-weight:bold" title="仅当前语言&#10;(如果不起作用，请手动保存)" download>保存本页</a>。</p><noscript><p style="font-weight:bold;color:red">此网站需要Javascript。启用以使用高级功能。</p></noscript>
<form id="func" action="javascript:if(func.elements[0].value)execute[func.elements[0].value](output,func.elements[1].value)" onreset="var arg=this.elements[1];arg.disabled=true;arg.removeAttribute('placeholder')">
<script type="text/javascript">'use strict';var execute={debugMode:function(){var e=func.elements[0];e.children[4].disabled=false;e.removeChild(e.children[3])},blobWorker:function(code,count,customErr){if(!window.Worker){alert('不支持Web Worker');throw Worker};var url=window.URL.createObjectURL(new Blob([code])),workers=[];for(var i=0;i<(count||1);i++)workers[workers.push(new Worker(url))-1].onerror=customErr||function(err){var p=document.createElement('p');p.style['font-weight']='bold';p.style['color']='red';p.style['word-break']='break-all';p.innerHTML=err.message;output.appendChild(p);this.terminate()};return {workers:workers,url:url}},wait:function(sec){if(window.wait){return true}else{window.wait=true;setTimeout(function(){window.wait=undefined},sec||1000)};return false},random:function(count,from,to,step){count=parseInt(count);if(isNaN(count)){throw new TypeError(count+' is not an integer')};if(count<1||count>4294967295){throw new RangeError('An unsigned 32-bit positive integer is required')};step=parseFloat(step);if(isNaN(step))step=0;if((to-from)*step<0){throw new RangeError('Step ('+step+') and '+(to-from)+' must have the same sign')};var genNum=new Array(count);if(step===0){var m=to-from;for(var i=0;i<count;i++)genNum[i]=Math.random()*m+(+from)}else{var m=Math.ceil(Math.abs((to-from)/step));for(var i=0;i<count;i++)genNum[i]=Math.floor(Math.random()*m)*step+(+from)};return genNum},geolocation:function(out){out.innerHTML='正在获取位置……';navigator.geolocation.getCurrentPosition(function(pos){out.innerHTML='长度单位：m 角度单位：°<br>';for(var name in pos.coords)if(pos.coords[name]!==null&&!isNaN(pos.coords[name]))out.innerHTML+=name+': '+pos.coords[name]+'<br>';out.innerHTML+='timestamp: '+new Date(pos.timestamp).toString()+'<br><input type="button" onclick="func.elements[2].disabled=true;func.elements[3].disabled=true;var stop=\'<input type=&quot;button&quot; onclick=&quot;var out=this.parentNode;navigator.geolocation.clearWatch(watch);func.elements[2].disabled=false;func.elements[3].disabled=false;watch=motion=undefined;out.removeChild(this);out.innerHTML+=\\\'已停止\\\'&quot; value=&quot;停止&quot;>\';window.watch=navigator.geolocation.watchPosition(function(pos){var data=\'监视中……<br>\';if(!window.motion)window.motion={s:0,startTime:pos.timestamp,preTime:pos.timestamp};var t=pos.timestamp-motion.preTime;motion.preTime=pos.timestamp;if(pos.coords.speed)motion.s+=pos.coords.speed*t/1000;var v=motion.s*1000/(pos.timestamp-motion.startTime);for(var name in pos.coords)if(pos.coords[name]!==null&&!isNaN(pos.coords[name]))data+=name+\': \'+pos.coords[name]+\'<br>\';if(motion.s)data+=\'路程: \'+motion.s+\'<br>\'+\'平均速率: \'+v+\'<br>\';output.innerHTML=data+\'timestamp: \'+new Date(pos.timestamp).toString()+\'<br>\'+stop},function(err){var type=[\'拒绝访问\',\'位置不可用\',\'超时\'];output.innerHTML=type[err.code-1]+\'<br>\'+stop},{enableHighAccuracy:true})" value="监视 (高精度)">'},function(err){var type=['拒绝访问','位置不可用','超时'];out.innerHTML=type[err.code-1]},{timeout:10000})},basicInfo:function(out){out.innerHTML='用户代理 (UA)：<code>'+navigator.userAgent+'</code><br>平台：'+navigator.platform+'<br>网络状态：'+(navigator.onLine?'在线':'离线')+'<br>逻辑处理器核心：'+(navigator.hardwareConcurrency||'(不支持)')+'<br>最大触摸点：'+('maxTouchPoints' in navigator?navigator.maxTouchPoints:'(不支持)')},vibrate:function(out,arg){arg=arg.split(' ');out.innerHTML=navigator.vibrate(arg)?'振动'+arg+'ms':'Failed'},DeviceMotion:function(out){func.elements[2].disabled=func.elements[3].disabled=true;out.innerHTML='线性加速度单位：m/s²<br>角速度单位：°/s<br><a href="https://developer.mozilla.org/en-US/docs/Web/API/Device_orientation_events/Orientation_and_motion_data_explained">x、y、z和alpha、beta、gamma是什么意思？</a><br><b>设备运动：</b><div id="mt"></div><b>设备方向：</b><div id="ot"></div><input type="button" onclick="var out=this.parentNode;window.removeEventListener(\'devicemotion\',handler.m);\'ondeviceorientationabsolute\' in window?window.removeEventListener(\'deviceorientationabsolute\',handler.o):window.removeEventListener(\'deviceorientation\',handler.o);handler=motion=undefined;func.elements[2].disabled=func.elements[3].disabled=false;out.removeChild(this);out.innerHTML+=\'已停止\';" value="停止">';window.handler={m:function(m){var data='';for(var name in m.acceleration)if(m.acceleration[name]!==null)data+=name+': '+m.acceleration[name]+'<br>　('+m.accelerationIncludingGravity[name]+')<br>';for(var name in m.rotationRate)if(m.rotationRate[name]!==null)data+=name+': '+m.rotationRate[name]+'<br>';var t=m.interval>1?m.interval/1000:m.interval;data=data?data+'interval: '+t*1000+'ms':'传感器不可用';if(window.motion){var cx=Math.cos(motion.beta),cy=Math.cos(motion.gamma),cz=Math.cos(motion.alpha),sx=Math.sin(motion.beta),sy=Math.sin(motion.gamma),sz=Math.sin(motion.alpha);motion.a.x=m.acceleration.x*cy*cz+cx*(m.acceleration.z*sy-m.acceleration.y*sz);motion.a.y=m.acceleration.y*cx*cz+cy*(m.acceleration.x*sz-m.acceleration.z*sx);motion.a.z=m.acceleration.z*cx*cy+cz*(m.acceleration.y*sx-m.acceleration.x*sy);['x','y','z'].forEach(function(i){motion.s[i]+=(motion.v[i]+0.5*motion.a[i]*t)*t;motion.v[i]+=motion.a[i]*t});data+='<br><b>估测值：</b><table border="1" style="word-break:break-all"><tr><th>轴</th><th>加速度</th><th>速度</th><th>位移</th></tr>';['x','y','z'].forEach(function(i){data+='<tr><td>'+i+'</td><td>'+motion.a[i]+'</td><td>'+motion.v[i]+'</td><td>'+motion.s[i]+'</td></tr>'});data+='<tr><td>合计</td><td>'+(motion.a.x**2+motion.a.y**2+motion.a.z**2)**0.5+'</td><td>'+(motion.v.x**2+motion.v.y**2+motion.v.z**2)**0.5+'</td><td>'+(motion.s.x**2+motion.s.y**2+motion.s.z**2)**0.5+'</td></tr></table>'};mt.innerHTML=data},o:function(o){var data='';ot.innerHTML='<span style="cursor:help" title="关于地球坐标系">绝对值</span>: '+o.absolute+'<br>';['alpha','beta','gamma'].forEach(function(name){if(o[name]!==null){if(!window.motion)window.motion={a:{},v:{x:0,y:0,z:0},s:{x:0,y:0,z:0}};data+=name+': '+o[name]+'<br>';motion[name]=o[name]}});ot.innerHTML+=data||'传感器不可用'}};DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(status){if(status==='granted'){window.addEventListener('devicemotion',handler.m)}else{mt.innerHTML='拒绝访问'}}):window.addEventListener('devicemotion',handler.m);DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(status){if(status==='granted'){window.addEventListener('deviceorientation',handler.o)}else{ot.innerHTML='拒绝访问'}}):'ondeviceorientationabsolute' in window?window.addEventListener('deviceorientationabsolute',handler.o):window.addEventListener('deviceorientation',handler.o)},Notify:function(out,arg){if(arg===''){out.innerHTML='语法：<code style="word-break:break-all">标题[``内容[``图标[``点击时执行的语句[``显示时执行的语句[``出错时执行的语句[``关闭时执行的语句]]]]]]</code>';return};arg=arg.split('``');Notification.requestPermission().then(function(status){if(status==='granted'){window.msg=new Notification(arg[0],{body:arg[1],icon:arg[2]});msg.onclick=new Function(arg[3]);msg.onshow=new Function(arg[4]);msg.onerror=new Function(arg[5]);msg.onclose=new Function(arg[6]);out.innerHTML='通知已发送<br><input type="button" onclick="msg.close();this.parentNode.innerHTML=\'已关闭\'" value="关闭">'}else{out.innerHTML='拒绝访问'}})},copy:function(undefined,arg){if(arg===''){var elements=document.getElementsByTagName('*'),id=[];for(var element=0;element<elements.length;element++)if(elements[element].id)id.push(elements[element].id);alert('含有id的元素：\n'+id);return};var e=this.custom(null,'return '+arg);if(typeof e==='undefined')return;var report=function(f){alert(f?'成功':'失败')};if(e&&e.childNodes){if(e.parentNode){if(e.select){e.select();report(document.execCommand('copy'));return}else if(window.getSelection){window.getSelection().selectAllChildren(e);report(document.execCommand('copy'));return}else{e=e.innerText||e.textContent}}else{e=e.outerHTML}};if(Object.prototype.toString.call(e)==='[object Object]')try{e=JSON.stringify(e)}catch(undefined){};if(navigator.clipboard){navigator.clipboard.writeText(e).then(function(){report(true)},function(){report(false)});return}else if(window.clipboardData){report(window.clipboardData.setData('text',e));return};alert('请手动复制')},custom:function(out,code){if(code===''){out.innerHTML='<textarea placeholder="在此输入代码" spellcheck="false"></textarea><input type="submit" title="右击以在Worker中运行&#10;(清空输入)" onclick="execute.custom(this.parentNode,this.previousSibling.value||null)" oncontextmenu="execute.workers(this.parentNode,\'1``\'+this.previousSibling.value||null);return false" value="运行">';return};try{return new Function(code)(out)}catch(err){var error=err.stack?err.stack.indexOf(err.message)!==-1?err.stack:err.toString()+'\n'+err.stack:err.name+': '+err.message;if(!out){alert(error);return};var p=document.createElement('p');p.style['font-weight']='bold';p.style['color']='red';p.style['word-break']='break-all';p.innerHTML=error.replace(/\n/g,'<br>');out.appendChild(p)}},readfile:function(out,arg){var atag='result.getElementsByTagName(\'audio\')',vtag='result.getElementsByTagName(\'video\')',fe='Array.prototype.forEach.call';out.innerHTML='<input type="file" id="fs" onchange="if(!window.reader){window.reader=new FileReader();reader.onabort=function(){if(window.text)text.innerHTML=\'已中止\'};reader.onerror=function(){if(window.text)text.innerHTML=\'发生错误\'};reader.onloadstart=function(){func.elements[2].disabled=func.elements[3].disabled=true;if(window.text)text.innerHTML=\'<p></p><input type=&quot;reset&quot; onclick=&quot;reader.abort()&quot; value=&quot;中止&quot;>\'};reader.onprogress=function(e){if(window.text)text.childNodes[0].innerHTML=\'已加载 <b>\'+e.loaded+\' 字节 / \'+e.total+\' 字节</b> (\'+e.loaded/e.total*100+\'%)\'};reader.onloadend=function(){func.elements[2].disabled=func.elements[3].disabled=false;if(window.text&&text.childNodes[1])text.innerHTML=\'\'}};var data=\'\';for(var file=0;file<files.length;file++){for(var name in files[file])if(typeof files[file][name]!==\'function\')data+=name+\': \'+files[file][name]+\'<br>\';if(/html|css|javascript/i.test(files[file].type)){data+=\'<input type=&quot;button&quot; onclick=&quot;reader.onload=function(event){\';switch(files[file].type){case \'text/javascript\':data+=\'var js=document.createElement(\\\'script\\\');js.type=\\\'text/javascript\\\';js.innerHTML=event.target.result;result.appendChild(js)\';break;case \'text/html\':data+=\'var html=window.open(\\\'\\\',\\\'\\\',\\\'popup\\\');if(!html){alert(\\\'弹出窗口被阻止\\\');return};html.document.write(event.target.result);html.document.close()\';break;case \'text/css\':data+=\'var css=document.createElement(\\\'style\\\');css.type=\\\'text/css\\\';css.innerHTML=event.target.result;result.appendChild(css)\'};data+=\'};reader.readAsText(fs.files[\'+file+\'],cset.value)&quot; value=&quot;执行&quot;>\'};if(/audio|video|image/i.test(files[file].type)){data+=\'<input type=&quot;button&quot; onclick=&quot;var media=document.createElement(\\\'\';switch(files[file].type.split(\'/\')[0]){case \'audio\':data+=\'audio\';break;case \'video\':data+=\'video\';break;case \'image\':data+=\'img\'};data+=\'\\\');if(!media)return;if(media.controls===false)media.controls=true;media.style.width=\\\'100%\\\';window.urls=window.urls||[];if(!this.hasAttribute(\\\'data-url\\\'))this.setAttribute(\\\'data-url\\\',window.urls[window.urls.push(window.URL.createObjectURL(fs.files[\'+file+\']))-1]);media.src=this.getAttribute(\\\'data-url\\\');result.appendChild(media);ctrl.style.display=\\\'\\\'&quot; title=&quot;某些格式不被支持&quot; value=&quot;播放&quot;>\'};data+=\'<input type=&quot;button&quot; title=&quot;左击以显示&amp;#10;右击以复制&amp;#10;(仅限文本)&quot; onclick=&quot;reader.onload=function(event){\\\'innerText\\\' in text?text.innerText=event.target.result:text.textContent=event.target.result};reader.readAsText(fs.files[\'+file+\'],cset.value)&quot; oncontextmenu=&quot;reader.onload=function(event){execute.copy(null,\\\'reader.result\\\')};reader.readAsText(fs.files[\'+file+\'],cset.value);return false&quot; value=&quot;读取&quot;><input type=&quot;button&quot; title=&quot;左击以显示&amp;#10;右击以复制&quot; onclick=&quot;reader.onload=function(event){\\\'innerText\\\' in text?text.innerText=event.target.result:text.textContent=event.target.result};reader.readAsDataURL(fs.files[\'+file+\'],cset.value)&quot; oncontextmenu=&quot;reader.onload=function(event){execute.copy(null,\\\'reader.result\\\')};reader.readAsDataURL(fs.files[\'+file+\'],cset.value);return false&quot; value=&quot;Base64&quot;><br><br>\'};info.innerHTML=data" '+(arg?arg==='.'?'webkitdirectory':'accept="'+arg+'"':'')+' multiple> <label>字符集：<input type="text" id="cset" list="csets" placeholder="默认：UTF-8" spellcheck="false"></label> <input type="reset" onclick="text.innerHTML=result.innerHTML=\'\';ctrl.style.display=\'none\'" value="清空输出"><div id="ctrl" style="display:none"><input type="button" onclick="'+fe+'('+vtag+',function(i){i.play()});'+fe+'('+atag+',function(i){i.play()})" value="全部播放"><input type="button" onclick="'+fe+'('+vtag+',function(i){i.pause()});'+fe+'('+atag+',function(i){i.pause()})" value="全部暂停"><input type="button" onclick="'+fe+'('+vtag+',function(i){i.paused?i.play():i.pause()});'+fe+'('+atag+',function(i){i.paused?i.play():i.pause()})" title="播放暂停的; 暂停播放的" value="全部切换"> <label>全局速度：<input type="number" onchange="var val=this.value,adjust=function(i){try{i.playbackRate=val<0?i.playbackRate*-val:val}catch(e){}};'+fe+'('+vtag+',adjust);'+fe+'('+atag+',adjust);if(this.value<0)this.value=\'\'" placeholder="负值=倍数" step="0.01"></label></div><div id="info" style="word-break:break-all"></div><div id="text" style="word-break:break-all"></div><div id="result"></div>'},audio:function(out,arg){if(!window.audio){arg=parseFloat(arg);try{window.audio=new (window.AudioContext||window.webkitAudioContext)(arg>0?{sampleRate:arg}:undefined)}catch(e){out.innerHTML=e.toString();return};audio.onstatechange=function(){if(!window.mute)return;if(this.state==="running"){mute.disabled=false;mute.value="暂停";mute.onclick=function(){audio.suspend()}}else if(this.state!=="closed"){mute.value="恢复";mute.onclick=function(){audio.resume();this.disabled=true;this.value="请稍候……"}}}};var clampMin='if(+this.value<this.min){this.value=this.min}',clampMax='if(+this.value>this.max){this.value=this.max}';audio.sonodes=audio.sonodes||[];audio.prnodes=audio.prnodes||[];audio.audioData=audio.audioData||[];audio.showNode=function(isSource,node){var ele=document.createElement('li'),data='';if(isSource?this.sonodes[node]:this.prnodes[node]){switch(isSource?this.sonodes[node].tp:this.prnodes[node].tp){case 'OscillatorNode':data='<label>类型：<select onchange="audio.sonodes['+node+'].type=this.value"><option value="sine">正弦波</option><option value="square">方波</option><option value="sawtooth">锯齿波</option><option value="triangle">三角波</option></select></label> <label>频率：<input type="number" onchange="'+clampMin+'else '+clampMax+';audio.sonodes['+node+'].frequency.value=this.value" min="'+-this.sampleRate/2+'" max="'+this.sampleRate/2+'" list="savedf" value="'+this.sonodes[node].frequency.value+'">Hz</label> <input type="button" onclick="var p=this.previousElementSibling.childNodes[1];p.value/=2**(1/12);p.onchange()" oncontextmenu="var p=this.previousElementSibling.childNodes[1];p.value/=2;p.onchange();return false" title="右击（或按住）此按钮以降低八度" value="-半音"><input type="button" onclick="var p=this.previousSibling.previousElementSibling.childNodes[1];p.value=audio.sonodes['+node+'].frequency.value=Math.random()*-p.max+(+p.max)" title="范围：(0,采样频率]" value="随机"><input type="button" onclick="var p=this.previousSibling.previousSibling.previousElementSibling.childNodes[1];p.value*=2**(1/12);p.onchange()" oncontextmenu="var p=this.previousSibling.previousSibling.previousElementSibling.childNodes[1];p.value*=2;p.onchange();return false" title="右击（或按住）此按钮以升高八度" value="+半音">';break;case 'AudioBufferSourceNode':data='<label>缓冲区：<select name="buffer" onchange="audio.sonodes['+node+'].buffer=audio.audioData[this.value-1];this.disabled=true" '+(this.sonodes[node].buffer?'disabled':'')+'>'+this.updateBuffer(false)+'</select></label> <label>调音：<input type="number" oninput="audio.sonodes['+node+'].detune.value=this.value" value="'+this.sonodes[node].detune.value+'"></label> <label title="如未选中，此节点将在缓冲区播放完成后自动移除">循环<input type="checkbox" onchange="audio.sonodes['+node+'].loop=this.checked" '+(this.sonodes[node].loop?'checked':'')+'></label> <label>速率：<input type="number" oninput="'+clampMin+';audio.sonodes['+node+'].playbackRate.value=this.value" min="0" step="0.01" list="0.25-1-2" value="'+this.sonodes[node].playbackRate.value+'"></label>';break;case 'GainNode':data='<label>音量：<input type="number" oninput="audio.prnodes['+node+'].gain.value=this.value" step="0.01" list="0-1-2" value="'+this.prnodes[node].gain.value+'"></label>';break;case 'StereoPannerNode':data='<label>平衡：<input type="range" oninput="audio.prnodes['+node+'].pan.value=this.value;this.title=this.value" min="-1" max="1" step="0.01" list="-1-0-1" value="'+this.prnodes[node].pan.value+'"></label>'}if(isSource){data+=' <label>连接到：<select name="connect" data-source data-index="'+node+'" onchange="var node=audio.sonodes['+node+'];node.disconnect();if(this.value){try{node.start()}catch(undefined){};node.connect(this.value===\'dest\'?audio.destination:audio.prnodes[this.value])};node.to=this.value"></select></label> <input type="button" onclick="audio.removeNode(true,'+node+',this.parentNode)" value="停止">'}else{if(this.prnodes[node].channelCountMode!=='max'){data+='<!-- <label>声道数量：<input type="number" onchange="'+clampMin+'else '+clampMax+'else{this.value=parseInt(this.value)};audio.prnodes['+node+'].channelCount=this.value" min="1" max="'+audio.destination.maxChannelCount+'" value="'+this.prnodes[node].channelCount+'"></label>-->'};data+=' <label>连接到：<select name="connect" data-index="'+node+'" onchange="var node=audio.prnodes['+node+'];node.disconnect();if(this.value)node.connect(this.value===\'dest\'?audio.destination:audio.prnodes[this.value]);node.to=this.value"></select></label> <input type="button" onclick="audio.removeNode(false,'+node+',this.parentNode)" value="移除">'}}else{ele.style['text-decoration']='line-through'};ele.innerHTML=data||'空空如也';if(isSource&&this.sonodes[node]){switch(this.sonodes[node].tp){case 'OscillatorNode':ele.getElementsByTagName('select')[0].value=this.sonodes[node].type;break;case 'AudioBufferSourceNode':ele.getElementsByTagName('select')[0].value=(this.audioData.indexOf(this.sonodes[node].buffer)+1||'')}this.sonodes[node].onended=function(){audio.removeNode(2,node,ele)}};return ele};audio.addNode=function(isSource,type){switch(type){case 'OscillatorNode':this.sonodes[this.sonodes.push(this.createOscillator())-1].tp='OscillatorNode';break;case 'AudioBufferSourceNode':this.sonodes[this.sonodes.push(this.createBufferSource())-1].tp='AudioBufferSourceNode';break;case 'GainNode':this.prnodes[this.prnodes.push(this.createGain())-1].tp='GainNode';break;case 'StereoPannerNode':this.prnodes[this.prnodes.push(this.createStereoPanner())-1].tp='StereoPannerNode'}var node=isSource?this.sonodes.length-1:this.prnodes.length-1;return this.showNode(isSource,node)};audio.removeNode=function(isSource,index,node){if(isSource){try{audio.sonodes[index].stop();if(isSource<2)return}catch(undefined){};this.sonodes[index]=null}else{this.prnodes[index].disconnect();this.prnodes[index]=null;this.updateNode(index)};if(node){node.innerHTML=isSource?'已停止':'已移除';node.style['text-decoration']='line-through';var panode=node.parentNode;if(panode)if(isSource){while(this.sonodes[this.sonodes.length-1]===null){panode.removeChild(panode.lastChild);this.sonodes.pop()}}else{while(this.prnodes[this.prnodes.length-1]===null){panode.removeChild(panode.lastChild);this.prnodes.pop()}}}};audio.updateNode=function(index){var sels=document.getElementsByName('connect'),data='<option value="">无</option><option value="dest">输出</option>';for(var node=0;node<this.prnodes.length;node++)if(this.prnodes[node])data+='<option value="'+node+'">'+(node+1)+'</option>';for(var sel=0,node;sel<sels.length;sel++){node=sels[sel].hasAttribute('data-source')?this.sonodes[sels[sel].getAttribute('data-index')]:this.prnodes[sels[sel].getAttribute('data-index')];sels[sel].innerHTML=data;if(node){sels[sel].value=node.to==index?node.to='':node.to||''}}};audio.addData=function(type,opt1,opt2,opt3){try{switch(type){case 'AudioBuffer':this.audioData[this.audioData.push(this.createBuffer(opt1,opt2,opt3))-1].tp='AudioBuffer';this.updateBuffer(true)}}catch(err){alert('创建'+type+'失败，可能是因为内存不足？'+'\n\n'+err.toString());return};var ad=this.audioData.length-1;return this.showData(ad)};audio.showData=function(ad){var ele=document.createElement('li'),data='';if(this.audioData[ad]){switch(this.audioData[ad].tp){case 'AudioBuffer':data='声道数量：'+this.audioData[ad].numberOfChannels+' 采样频率：'+this.audioData[ad].sampleRate+'Hz 时长：'+this.audioData[ad].duration+'s <input type="button" onclick="info.innerHTML=\'正在编辑：<b>'+(ad+1)+'</b> 长度：<b>'+this.audioData[ad].length+'帧</b> <label>声道：<input type=\\\'number\\\' min=\\\'1\\\' max=\\\''+this.audioData[ad].numberOfChannels+'\\\' required></label>\';bfeditor.action=\'javascript:\\\'use strict\\\';(function(input){var arg=[];for(var i=0;i<6;i++)arg.push(input[i].value);var buffer=new Float32Array(arg[2]-arg[1]+1);audio.audioData['+ad+'].copyFromChannel(buffer,arg[0]-1,arg[1]-1);if(!audio.worker){audio.worker=execute.blobWorker(\\\'\\\\\\\'use strict\\\\\\\';self.onmessage=function(event){var data=new Float32Array(event.data.content),input=event.data.arg,f=event.data.frequency;for(var ch=0;ch<data.length;ch+=+input[3]){if(f&&ch%(input[3]*f)===0)self.postMessage({type:\\\\\\\'pending\\\\\\\',content:ch*100/data.length});data[ch]=input[5]==input[4]?+input[4]:Math.random()*(input[5]-input[4])+(+input[4])};self.postMessage({type:\\\\\\\'finished\\\\\\\',content:data.buffer,arg:input},[data.buffer])}\\\',1,function(err){alert(err.message);func.elements[2].disabled=func.elements[3].disabled=fill.disabled=false});audio.worker.workers[0].onmessage=function(event){switch(event.data.type){case \\\'pending\\\':input[6].value=event.data.content+\\\'%\\\';break;case \\\'finished\\\':audio.audioData['+ad+'].copyToChannel(new Float32Array(event.data.content),event.data.arg[0]-1,event.data.arg[1]-1);input[6].value=\\\'填充\\\';input[7].value=\\\'完成\\\';func.elements[2].disabled=func.elements[3].disabled=input[6].disabled=false}}};audio.worker.workers[0].postMessage({content:buffer.buffer,arg:arg,frequency:audio.sampleRate/10},[buffer.buffer]);input[7].value=\\\'取消\\\';func.elements[2].disabled=func.elements[3].disabled=input[6].disabled=true})(bfeditor.elements)\';fill.disabled=false;bfeditor.parentNode.style.display=\'\';bfeditor.elements[2].max=audio.audioData['+ad+'].length" value="编辑内容"><input type="button" onclick="var from=parseInt(prompt(\'输入源声道：\'))-1,offset1=Math.abs(parseInt(prompt(\'源偏移：(可选)\'))),length=parseInt(prompt(\'输入长度：\'));if(!(from>=0&&length>0)){alert(\'非法的源输入\');return};var dest=parseInt(prompt(\'输入目标缓冲区：\','+(ad+1)+'))-1,to=parseInt(prompt(\'输入目标声道：\'))-1,offset2=Math.abs(parseInt(prompt(\'目标偏移：(可选)\')));if(!(dest>=0&&to>=0)){alert(\'非法的目标输入\');return};try{var buffer=new Float32Array(length);audio.audioData['+ad+'].copyFromChannel(buffer,from,offset1);audio.audioData[dest].copyToChannel(buffer,to,offset2);alert(\'完成\')}catch(err){alert(err.toString())}" value="声道间复制">'}}else{ele.style['text-decoration']='line-through'};ele.innerHTML=data||'空空如也';return ele};audio.updateBuffer=function(isModify){var sels=document.getElementsByName('buffer'),data='<option value="">空</option>';for(var dt=0;dt<this.audioData.length;dt++)if(this.audioData[dt].tp==='AudioBuffer')data+='<option value="'+(dt+1)+'">'+(dt+1)+'</option>';if(isModify){for(var sel=0,dt;sel<sels.length;sel++){dt=sels[sel].value;sels[sel].innerHTML=data;sels[sel].value=dt}}else{return data}};out.innerHTML='<p>这只是<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Web Audio API</a>的冰山一角。<br>当前采样频率：<b>'+audio.sampleRate+'Hz</b><br><span style="color:orange;font-weight:bold">警告：过多的节点或缓冲区会使浏览器崩溃！</span><fieldset><legend>音高到频率转换器</legend><input type="number" oninput="this.nextSibling.value=this.value?440*2**((this.value-69)/12):\'\'" min="0" placeholder="音高"><input type="number" oninput="'+clampMin+';this.previousSibling.value=+this.value>this.min?Math.log2(this.value/440)*12+69:\'\'" min="0" step="0.001" placeholder="频率"><input type="button" onclick="savedf.innerHTML+=\'<option value=&quot;\'+this.previousSibling.value+\'&quot;>音高：\'+this.previousSibling.previousSibling.value+\'</option>\'" title="粘贴到&quot;频率&quot;字段" value="添加到数据列表"><input type="reset" onclick="savedf.innerHTML=\'\'" value="清空数据列表"></fieldset></p><label>声道数量：<input type="number" onchange="'+clampMin+'else '+clampMax+'else{this.value=parseInt(this.value)};audio.destination.channelCount=this.value" min="1" max="'+audio.destination.maxChannelCount+'" value="'+audio.destination.channelCount+'"></label> <input type="button" id="mute" '+(audio.state==='suspended'?'onclick="audio.resume();this.disabled=true;this.value=\'请稍候……\'" value="恢复"':'onclick="if(audio.suspend){audio.suspend()}else{this.disabled=true}" value="暂停"')+'><input type="reset" onclick="if(!execute.wait()&&!confirm(\'清除数据并停止？\'))return;bfeditor.reset();for(var node=0;node<audio.sonodes.length;node++)if(audio.sonodes[node])audio.removeNode(true,node);for(var node=0;node<audio.prnodes.length;node++)if(audio.prnodes[node])audio.removeNode(false,node);audio.sonodes=audio.prnodes=audio.audioData=audio.showNode=audio.addNode=audio.removeNode=audio.updateNode=audio.addData=audio.showData=audio.updateBuffer=undefined;if(audio.close){audio.close();audio=undefined};this.parentNode.innerHTML=\'已停止\'" value="停止"><br><select onchange="switch(this.value){case \'AudioBuffer\':this.nextSibling.placeholder=\'帧数\'}"><option value="AudioBuffer">音频缓冲区</option></select><input type="number" onchange="this.value=+this.value<this.min?this.value?this.min:\'\':parseInt(this.value)" oninput="this.nextSibling.disabled=!this.value" min="1" placeholder="帧数"><input type="button" onclick="var dt=audio.addData(this.previousSibling.previousSibling.value,audio.destination.channelCount,this.previousSibling.value,audio.sampleRate);if(dt)this.nextSibling.nextSibling.appendChild(dt)" value="新音频数据" disabled><input type="reset" onclick="audio.audioData=[];this.nextSibling.innerHTML=\'\';bfeditor.reset();for(var node=0;node<audio.sonodes.length;node++)if(audio.sonodes[node]&&audio.sonodes[node].buffer)audio.removeNode(true,node,this.parentNode.getElementsByTagName(\'ul\')[0].childNodes[node]);audio.updateBuffer(true)" value="清空音频数据"><ol></ol><fieldset style="display:none"><legend>编辑器</legend><form action="javascript:" id="bfeditor" onreset="if(audio.worker){audio.worker.workers[0].terminate();window.URL.revokeObjectURL(audio.worker.url);audio.worker=undefined};this.action=\'javascript:\';info.innerHTML=\'\';fill.disabled=true;func.elements[2].disabled=func.elements[3].disabled=false;this.parentNode.style.display=\'none\'"><p>此编辑器将帮助向缓冲区填充一些随机噪音（PCM编码）。<br><b>不同声道的数据分开存放</b>，请注意。<br>所做的更改将会在<b>点击“填充”按钮时</b>生效。（可能需要一些时间）</p><p id="info"></p><label>起始：<input type="number" onchange="this.parentNode.nextElementSibling.childNodes[1].min=this.value" placeholder="输入帧数" min="1" required></label> <label>终止：<input type="number" onchange="this.parentNode.previousElementSibling.childNodes[1].max=this.value" placeholder="输入帧数" required></label> <label>步长：<input type="number" min="1" value="1" required></label><br>随机范围：<input type="number" step="0.001" required>~<input type="number" step="0.001" required> <input id="fill" type="submit" value="填充"><input type="reset" value="完成"></form></fieldset><select><option value="OscillatorNode">振荡器</option><option value="AudioBufferSourceNode">音频缓冲区源</option></select><input type="button" onclick="this.nextSibling.appendChild(audio.addNode(true,this.previousSibling.value));audio.updateNode()" value="新节点 (音源)"><ul></ul><select><option value="GainNode">音量</option><option value="StereoPannerNode">立体声平衡</option></select><input type="button" onclick="this.nextSibling.appendChild(audio.addNode(false,this.previousSibling.value));audio.updateNode()" value="新节点 (处理)"><ol></ol>';for(var ad=0;ad<audio.audioData.length;ad++)out.getElementsByTagName('ol')[0].appendChild(audio.showData(ad));for(var node=0;node<audio.sonodes.length;node++)out.getElementsByTagName('ul')[0].appendChild(audio.showNode(true,node));for(var node=0;node<audio.prnodes.length;node++)out.getElementsByTagName('ol')[1].appendChild(audio.showNode(false,node));audio.updateNode()},speak:function(out,arg){if(arg){window.speechSynthesis.speak(new SpeechSynthesisUtterance(arg));return};window.tts=window.tts||{ss:window.speechSynthesis,utters:[],showUtter:function(ut,isText){var ele=isText?{}:document.createElement('li');ele.innerHTML=ut?'语种：'+ut.voice.name+' 音高：'+ut.pitch+' 语速：'+ut.rate+' 音量：'+ut.volume:'（空）';return ele},updateUtter:function(isModify){var data='<option value="">新发音</option>';for(var ut=0;ut<this.utters.length;ut++)data+='<option value="'+ut+'">'+(ut+1)+'</option>';if(isModify){var sel=uteditor.elements[0],dt=sel.value;sel.innerHTML=data;sel.value=dt}else{return data}},updateVoice:function(){this.voices=this.ss.getVoices();var dton='',dtoff='';for(var voice=0,data;voice<this.voices.length;voice++){data='<option value="'+voice+'" '+(this.voices[voice]['default']?'selected':'')+'>'+this.voices[voice].name+' ('+this.voices[voice].lang+')'+(this.voices[voice]['default']?' (默认)':'')+'</option>';this.voices[voice].localService?dtoff+=data:dton+=data};return '<optgroup label="在线语音">'+dton+'</optgroup>'+'<optgroup label="离线语音">'+dtoff+'</optgroup>'},defineEvent:function(ut){ut.onresume=ut.onstart=function(event){tts.ts=tts.ts||new Date();if(window.state){state.innerHTML='讲话中'+(tts.ss.pending?'...':'')}else{return};pausebtn.value='暂停';pausebtn.disabled=false;stopbtn.value='停止'};ut.onpause=function(event){if(window.state){state.innerHTML='在第'+(event.charIndex+1)+'个字符处暂停'}else{return};pausebtn.value='恢复'};ut.onend=function(event){var time=tts.ts;tts.ts=undefined;if(window.state){state.innerHTML='完成（用时：'+event.elapsedTime+(new Date()-time<event.elapsedTime*10?'m':'')+'s）'}else{return};if(!tts.ss.speaking)pausebtn.disabled=true;stopbtn.value='重置'};ut.onerror=function(event){if(window.state){state.innerHTML='错误'+(event.error?'：'+event.error:'')}else{alert('发生错误'+(event.error?'：'+event.error:''));return};if(!tts.ss.speaking)pausebtn.disabled=true;stopbtn.value='重置'};return ut}};if(!tts.ss.paused)tts.ss.resume();out.innerHTML='<p>当前状态：<span style="font-weight:bold" id="state">'+(tts.ss.speaking?tts.ss.paused?'暂停中':'讲话中':'空闲')+(tts.ss.pending?'...':'')+'</span> <input type="button" id="pausebtn" onclick="if(this.value===\'暂停\'){tts.ss.pause();this.value=\'恢复\'}else{tts.ss.resume();this.value=\'暂停\'}" value="'+(tts.ss.paused?'恢复':'暂停')+'" '+(tts.ss.speaking?'':'disabled')+'><input type="reset" id="stopbtn" onclick="if(tts.ss.speaking){tts.ss.cancel()}else{if(!execute.wait()&&!confirm(\'清除数据并重置？\'))return;for(var ele in tts)tts[ele]=undefined;tts=undefined;this.parentNode.parentNode.innerHTML=\'已重置\'}" value="'+(tts.ss.speaking?'停止':'重置')+'"></p><textarea placeholder="在此输入文本">'+(tts.cu?tts.cu.text:'')+'</textarea><input type="submit" id="speakbtn" onclick="tts.cu.text=this.previousSibling.value;tts.ss.speak(tts.cu);tts.ss.resume()" value="讲话" '+(tts.cu?'':'disabled')+'><p>当前设置：<span style="font-weight:bold">'+tts.showUtter(tts.cu,true).innerHTML+'</span> <input type="button" onclick="var list=this.parentNode.parentNode.lastChild,ut=tts.utters[tts.utters.push(tts.cu)-1];list.appendChild(tts.showUtter(ut));ut.isSaved=true;this.disabled=true;tts.updateUtter(true)" value="保存" '+((tts.cu&&!tts.cu.isSaved)?'':'disabled')+'></p><form action="javascript:" onsubmit="tts.cu=function(input){var utter=input[0].value?tts.utters[input[0].value]:tts.defineEvent(new SpeechSynthesisUtterance());utter.voice=tts.voices[input[1].value];utter.pitch=input[2].value;utter.rate=10**input[3].value;utter.volume=input[4].value;return utter}(this.elements);speakbtn.disabled=false;this.previousSibling.childNodes[1].innerHTML=tts.showUtter(tts.cu,true).innerHTML;if(this.elements[0].value){var ut=this.elements[0].value,list=this.parentNode.lastChild;tts.utters[ut]=tts.cu;list.replaceChild(tts.showUtter(tts.utters[ut]),list.childNodes[ut])};this.previousSibling.lastChild.disabled=tts.cu.isSaved" onreset="this.elements[1].innerHTML=tts.updateVoice()" id="uteditor">选项：<label>模板：<select onchange="if(this.value){var opt=uteditor.elements,ut=tts.utters[this.value];opt[1].value=tts.voices.indexOf(ut.voice);opt[2].value=ut.pitch;opt[3].value=ut.rate;opt[4].value=ut.volume}">'+tts.updateUtter(false)+'</select></label><br><label>语种：<select required>'+tts.updateVoice()+'</select></label><br><label>音高：<input type="range" onchange="this.title=this.value" min="0" max="2" step="0.01" list="0-1-2" value="1"></label> <label>语速：<input type="range" onchange="this.title=10**this.value" min="-1" max="1" step="0.01" list="0.2-log10-5" value="0"></label> <label>音量：<input type="range" onchange="this.title=this.value" min="0" max="1" step="0.01" list="0-1-2" value="1"></label> <input type="submit"><input type="reset"></form>保存的模板：<input type="reset" onclick="tts.utters=[];this.nextSibling.innerHTML=uteditor.elements[0].value=\'\';tts.updateUtter(true);if(tts.cu)tts.cu.isSaved=false;this.previousElementSibling.previousSibling.lastChild.disabled=!tts.cu" value="清空"><ol></ol>';for(var ut=0;ut<tts.utters.length;ut++)out.getElementsByTagName('ol')[0].appendChild(tts.showUtter(tts.utters[ut]))},workers:function(out,arg){var arg=arg.split('``');arg[0]=parseInt(arg[0]);if(isNaN(arg[0])){out.innerHTML='非法输入<br>输入一个正整数以添加线程，一个负整数以移除线程（按顺序），或0以查看线程数。<br>如需自定义代码，输入一个正整数，然后输入“``”和紧跟着的一些代码。<br>（默认代码 (用于CPU测试): <code>while(true){}</code>）';return};window.st=window.st||{workers:[],url:null};if(st.url){window.URL.revokeObjectURL(st.url);st.url=null};if(arg[0]>0){arg[1]=arg[1]||'while(true){}';var t=this.blobWorker(arg[1],arg[0]);st.workers=st.workers.concat(t.workers);st.url=t.url}else if(arg[0]<0){for(var c=0;c>arg[0];c--){if(!st.workers.length)break;st.workers.shift().terminate()}};out.innerHTML='当前线程数：'+st.workers.length;if(!st.workers.length)st=undefined},getMedia:function(out,arg){if(navigator.mediaDevices){out.innerHTML='媒体设备：<ul id="devices" style="word-break:break-all"></ul>';if(navigator.mediaDevices.enumerateDevices){var ud=function(dv){if(!window.devices)return;devices.innerHTML='';for(var d=0,data;d<dv.length;d++){data=document.getElementById(dv[d].groupId);if(!data){data=document.createElement('li');data.id=dv[d].groupId;data.innerHTML='<b>'+dv[d].groupId+':</b>';devices.appendChild(data)};data.innerHTML+='<br>'+dv[d].kind+': '+(dv[d].label||'(Unknown)')+' ID: '+(dv[d].deviceId||'(Unknown)');if(/input/.test(dv[d].kind)&&dv[d].deviceId)data.innerHTML+=' <input type="button" onclick="'+(dv[d].kind==='audioinput'?'if(adid)adid':'if(vdid)vdid')+'.value=\''+dv[d].deviceId+'\'" value="使用此设备">'}};navigator.mediaDevices.enumerateDevices().then(ud)}else{out.innerHTML+='(不支持)'}}else{out.innerHTML=''};var data='此浏览器支持的设定：<ul style="column-width:11em">',loopSet=function(items){var result='';for(var i in items){result+='<label><input type="checkbox" name="'+i+'">'+items[i].name+'</label>';switch(items[i].type){case'number':result+='：<input type="number" '+(items[i].hasOwnProperty('min')?'min="'+items[i].min+'" ':'')+(items[i].hasOwnProperty('max')?'max="'+items[i].max+'" ':'')+(items[i].float?'step="1e-1023"':'')+'>';break;case'select':result+='：<select>';for(var o in items[i].options)result+='<option value="'+o+'">'+items[i].options[o]+'</option>';result+='</select>'};result+='<br>'};return result};for(var i in navigator.mediaDevices.getSupportedConstraints())data+='<li>'+i+'</li>';out.innerHTML+=data+'</ul>'+'<fieldset><legend>设定</legend><form id="st" action="javascript:(function(cons,get1,get2,err,m){if(!m){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia(cons).then(get1,err)}else{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;navigator.getUserMedia(cons,get1,err)}}else{var a=m.getAudioTracks(),v=m.getVideoTracks();if(a.length)a[0].applyConstraints(cons.audio).then(get2,err);if(v.length)v[0].applyConstraints(cons.video).then(get2,err)}})(window.getSet(fc,ae,ve,as,vs),function(s){var v=output.getElementsByTagName(\'video\')[0];window.userMedia=v.srcObject=s;v.play();window.udSet(s,ae,ve,as,vs)},function(){window.udSet(window.userMedia,ae,ve,as,vs)},function(e){log.value=Error.prototype.toString.call(e)+(e.constraint?\': \'+e.constraint:\'\')},window.userMedia)"><label title="不会忽略不支持的设定"><input type="checkbox" id="fc">强制</label><label><input type="checkbox" id="ae" onchange="as.disabled=!this.checked">音频</label><label><input type="checkbox" id="ve" onchange="vs.disabled=!this.checked">视频</label><ul style="list-style:none;padding-left:0;column-width:22em"><li><fieldset id="as" disabled><legend>音频</legend>'+loopSet({autoGainControl:{name:'自动音量控制'},channelCount:{name:'声道数量',type:'number',min:0},echoCancellation:{name:'回声消除'},latency:{name:'延迟',type:'number',min:0,float:true},noiseSuppression:{name:'降噪'},sampleRate:{name:'采样频率',type:'number',min:0},sampleSize:{name:'量化位数',type:'number',min:0}})+'<label><input type="checkbox" name="deviceId">设备ID</label>：<input type="text" id="adid"></fieldset></li><li><fieldset id="vs" disabled><legend>视频</legend>'+loopSet({aspectRatio:{name:'宽高比',type:'number',min:0,float:true},facingMode:{name:'朝向',type:'select',options:{user:'前',environment:'后',left:'左',right:'右'}},frameRate:{name:'帧率',type:'number',min:0,float:true},height:{name:'高度',type:'number',min:0},width:{name:'宽度',type:'number',min:0},resizeMode:{name:'缩放模式',type:'select',options:{none:'无','crop-and-scale':'裁剪缩放'}}})+'<label><input type="checkbox" name="deviceId">设备ID</label>：<input type="text" id="vdid"></fieldset></li></ul></form></fieldset>';window.getSet=function(f,ea,ev,a,v){var x=f.checked?'exact':'ideal';var result={audio:ea.checked?{}:false,video:ev.checked?{}:false};var loop=function(m,e){if(!result[m])return;var n=e.getElementsByTagName('input');for(var i=0;i<n.length;i++)if(n[i].type==='checkbox')if(n[i].parentNode.nextElementSibling.type){if(n[i].checked){result[m][n[i].name]={};result[m][n[i].name][x]=n[i].parentNode.nextElementSibling.value}}else{result[m][n[i].name]={};result[m][n[i].name][x]=n[i].checked}};loop('audio',a);loop('video',v);return result};window.udSet=function(m,ea,ev,sa,sv){ea.disabled=ev.disabled=m?true:false;if(!m)return;var at=m.getAudioTracks(),vt=m.getVideoTracks();ea.checked=at.length;sa.disabled=!ea.checked;ev.checked=vt.length;sv.disabled=!ev.checked;if(window.MediaStreamTrack.prototype.getSettings){var loop=function(t,e){if(t.length){var s=t[0].getSettings(),n=e.getElementsByTagName('input');for(var i=0;i<n.length;i++)if(n[i].type==='checkbox')if(n[i].parentNode.nextElementSibling.type){n[i].parentNode.nextElementSibling.value=s[n[i].name]||''}else{n[i].checked=s[n[i].name]}}};loop(at,sa);loop(vt,sv)}};out.innerHTML+='<input type="submit" form="st" onclick="this.value=\'更新\';this.nextSibling.value=\'停止\'" value="'+(arg||window.userMedia?'更新':'开始')+'"><input type="reset" onclick="if(window.userMedia){var t=userMedia.getTracks();for(var i=0;i<t.length;i++)t[i].stop();window.udSet(null,ae,ve,as,vs);window.userMedia=this.parentNode.getElementsByTagName(\'video\')[0].srcObject=null}else{var err=function(e){log.value=Error.prototype.toString.call(e)+(e.constraint?\': \'+e.constraint:\'\')};navigator.mediaDevices.getUserMedia(window.getSet(fc,ae,ve,as,vs)).then(function(m){log.value=\'\';var t=m.getTracks();for(var i=0;i<t.length;i++){if(window.MediaStreamTrack.prototype.getCapabilities)log.value+=JSON.stringify(t[i].getCapabilities())+\'\\n\\n\';t[i].stop()}}).then(function(){navigator.mediaDevices.enumerateDevices().then('+ud.toString().replace(/"/g,'&quot;')+')})[\'catch\'](err)};this.value=\'测试\';this.previousSibling.value=\'开始\'" value="'+(arg||window.userMedia?'停止':'测试')+'"><br>预览：<br><video controls style="width:100%"></video><br>输出：<br><textarea id="log" readonly></textarea>';if(arg)try{var err=function(e){log.value=Error.prototype.toString.call(e)+(e.constraint?': '+e.constraint:'')};arg=JSON.parse(arg);if(!window.userMedia){navigator.mediaDevices.getUserMedia(arg).then(function(s){var v=out.getElementsByTagName('video')[0];v.srcObject=window.userMedia=s;v.play();window.udSet(s,ae,ve,as,vs)},err)}else{var a=window.userMedia.getAudioTracks(),v=window.userMedia.getVideoTracks(),get=function(){window.udSet(window.userMedia,ae,ve,as,vs)};if(a.length)a[0].applyConstraints(arg.audio).then(get,err);if(v.length)v[0].applyConstraints(arg.video).then(get,err)}}catch(e){log.value=e.toString()};window.udSet(window.userMedia,ae,ve,as,vs);if(window.userMedia){var v=out.getElementsByTagName('video')[0];v.srcObject=window.userMedia;v.play()}},randomNum:function(out,arg){arg=arg.split(' ');try{if(arg.length<2)throw new SyntaxError('至少需要2个参数');var width=(19+(arg[3]||1).toString().length)/2+1;out.innerHTML='宽度：<input type="number" onchange="this.nextSibling.nextSibling.style.columnWidth=this.value+\'em\'" min="0" step="0.5" value="'+width+'">em<ol style="column-width:'+width+'em;width:90vw"><li>'+this.random(arg[3]||1,arg[0],arg[1],arg[2]).join('</li><li>')+'</li></ol>'}catch(e){out.innerHTML=e.toString()}}}</script>
<span style="display:none">
<datalist id="-1-0-1"><option>-1</option><option>-0.5</option><option>0</option><option>0.5</option><option>1</option></datalist>
<datalist id="0-1-2"><option>0</option><option>0.5</option><option>1</option><option>1.5</option><option>2</option></datalist>
<datalist id="0.25-1-2"><option>0.25</option><option>0.5</option><option>0.75</option><option>1</option><option>1.25</option><option>1.5</option><option>1.75</option><option>2</option></datalist>
<datalist id="0.2-log10-5"><option>-0.7</option><option>-0.3</option><option>0</option><option>0.3</option><option>0.7</option></datalist>
<datalist id="csets"><option>UTF-8</option><option value="UTF-16LE">UTF-16 小端</option><option value="UTF-16BE">UTF-16 大端</option><option value="GBK">GBK/GB2312</option><option value="windows-1252">ANSI (ASCII)</option></datalist>
<datalist id="savedf"></datalist>
</span>
<select name="function" onchange="var selected=this.options[this.selectedIndex],arg=this.parentNode.elements[1];(arg.disabled=selected.getAttribute('data-ph')===null)?arg.removeAttribute('placeholder'):arg.placeholder=selected.getAttribute('data-ph');arg.required=selected.getAttribute('data-rq')!==null" required>
<option value="" hidden>选择功能</option>
<optgroup label="视与听">
<option value="geolocation">显示/监视位置</option>
<option value="basicInfo">显示基本信息</option>
<option value="DeviceMotion">监视设备运动</option>
<option value="audio" data-ph="采样频率 (可选)">播放音频</option>
<option value="speak" data-ph="文本，留空显示选项">文本转语音 (TTS)</option>
<option value="getMedia" data-ph="设定 (JSON，可选)">观看媒体流</option>
</optgroup>
<optgroup label="做些事">
<option value="vibrate" data-ph="时间 (ms)，用空格分隔" data-rq>振动</option>
<option value="Notify" data-ph="选项，留空获取帮助">显示通知</option>
<option value="copy" data-ph="表达式，留空显示id">复制</option>
<option value="readfile" data-ph="类型，输入.以读取文件夹">读取文件</option>
<option value="randomNum" data-ph="<起> <止> [步进] [数量]" data-rq>随机数</option>
</optgroup>
<option value="debugMode">启用调试模式</option>
<optgroup label="调试" disabled>
<option value="custom" data-ph="代码，留空显示编辑器">运行Javascript</option>
<option value="workers" data-ph="语法：整数[``代码]">多线程</option>
</optgroup>
</select>
<input type="text" name="arg" spellcheck="false" disabled><input type="submit"><input type="reset" onclick="output.innerHTML='';function del(obj,isRepeat){if(!(obj instanceof Array))return;var count=0;while(obj.length){var i=obj.shift();if(isRepeat&&i instanceof Array){count+=del(i,true)}else if(typeof i==='string'&&i.indexOf('blob:')===0){window.URL.revokeObjectURL(i)}else if(window[i]!==undefined){window[i]=undefined;count++}};return count};del(window.urls);del(['urls','msg','reader','udSet','getSet'])" oncontextmenu="this.parentNode.reset();return false" title="右击仅重置输入">
</form>
<span id="output" style="display:inline-block;text-align:justify"></span>
<script type="text/javascript">"use strict";(function(nosupport,options,out){var notSupport=0;for(var option=0;option<options.length;option++)if(nosupport[options[option].value]){options[option].disabled=true;options[option].innerHTML+=" (不支持)";notSupport++};if(notSupport)out.innerHTML="检测到"+notSupport+"个不支持的功能。<br>体验可能会受到影响。"})({geolocation:!navigator.geolocation,vibrate:!navigator.vibrate,DeviceMotion:!window.DeviceMotionEvent,Notify:!window.Notification,readfile:!window.FileReader,audio:!(window.AudioContext||window.webkitAudioContext),speak:!window.speechSynthesis,workers:!window.Worker,getMedia:!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia)},func.elements[0].options,output);window.onscroll=function(){if((document.documentElement.scrollTop||document.body.scrollTop)>window.innerHeight){if(totop.style.display)totop.style.display=""}else{if(!totop.style.display)totop.style.display="none"}}</script>
<div style="position:fixed;left:0;bottom:0;width:100%"><input type="button" id="totop" style="display:none" title="右击以瞬间执行" onclick="var timer=setInterval(function(){document.documentElement.scrollTop||document.body.scrollTop?window.scrollBy(0,-100):clearInterval(timer)},10)" oncontextmenu="window.location.hash='#top';window.location.hash='';return false" value="返回顶部"><br><a href="https://github.com/2xh/2xh.github.io" title="在GitHub上">源代码</a> | <a href="https://github.com/2xh/2xh.github.io/issues">反馈</a> | <label>语言：<select onchange="var lang=this.value;this.selectedIndex=0;window.location.href='index'+lang+'.htm'"><option value="_zh-Hans" hidden>中文 (简体)</option><option value="">English</option></select></label></div>
</body>
</html>
